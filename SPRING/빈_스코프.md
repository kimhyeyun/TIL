__22_02_16__

# ë¹ˆ ìŠ¤ì½”í”„
## ë¹ˆ ìŠ¤ì½”í”„ë€?
ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ëŠ” ìŠ¤í”„ë§ ë¹ˆì´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ í•¨ê»˜ ìƒì„±ë˜ì–´ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ìœ ì§€ëœë‹¤ê³  í•™ìŠµ  
ì´ê²ƒì€ ìŠ¤í”„ë§ ë¹ˆì´ ê¸°ë³¸ì ìœ¼ë¡œ ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ë¡œ ìƒì„±ë˜ê¸° ë•Œë¬¸  
`ìŠ¤ì½”í”„ëŠ” ë²ˆì—­ ê·¸ëŒ€ë¡œ ë¹ˆì´ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ë²”ìœ„`

### ìŠ¤í”„ë§ì€ ë‹¤ìŒê³¼ ê°™ì€ ë‹¤ì–‘í•œ ìŠ¤ì½”í”„ë¥¼ ì§€ì›
- `ì‹±ê¸€í†¤` : ê¸°ë³¸ ìŠ¤ì½”í”„, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ ì¢…ë£Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ê°€ì¥ ë„“ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„
- `í”„ë¡œí† íƒ€ì…` : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì…ê¹Œì§€ë§Œ ê´€ì—¬í•˜ê³  ë”ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ë§¤ìš° ì§§ì€ ë²”ìœ„ì˜ ìŠ¤ì½”í”„
- `ì›¹ ê´€ë ¨ ìŠ¤ì½”í”„`
  - `request` : ì›¹ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆë•Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
  - `session` : ì›¹ ì„¸ì…˜ì´ ìƒì„±ë˜ê³  ì¢…ë£Œë ë•Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„
  - `application` : ì›¹ì˜ ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì™€ ê°™ì€ ë²”ìœ„ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„

ë¹ˆ ìŠ¤ì½”í”„ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì§€ì • ê°€ëŠ¥

**ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ìë™ ë“±ë¡**
```java
@Scope("prototype")
@Component
public class HelloBean{}
```
**ìˆ˜ë™ ë“±ë¡**
```java
@Scope("prototype")
@Bean
PrototypeBean HelloBean(){
    return new HelloBean();
}
```

### í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„
ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ì¡°íšŒí•˜ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì˜ ìŠ¤í”„ë§ ë¹ˆì„ ë°˜í™˜  
ë°˜ë©´ì— í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ë¥¼ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì¡°íšŒí•˜ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í•­ìƒ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜

**ì‹±ê¸€í†¤ ë¹ˆ ìš”ì²­**
![img_96.png](img_96.png)
1. ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ë³¸ì¸ì´ ê´€ë¦¬í•˜ëŠ” ìŠ¤í”„ë§ ë¹ˆì„ ë°˜í™˜
3. ì´í›„ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ê°™ì€ ìš”ì²­ì´ ì™€ë„ ê°™ì€ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ì˜ ìŠ¤í”„ë§ ë¹ˆì„ ë°˜í™˜

**í”„ë¡œí† íƒ€ì… ë¹ˆ ìš”ì²­ 1**
![img_97.png](img_97.png)
1. í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì´ ì‹œì ì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ê³ , í•„ìš”í•œ ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…

**í”„ë¡œí† íƒ€ì… ë¹ˆ ìš”ì²­ 2**
![img_98.png](img_98.png)
3. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ìƒì„±í•œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í´ë¼ì´ì–¸íŠ¸ì— ë°˜í™˜
4. ì´í›„ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ê°™ì€ ìš”ì²­ì´ ì˜¤ë©´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•´ì„œ ë°˜í™˜


### ì •ë¦¬ 
ì—¬ê¸°ì„œ í•µì‹¬ â€¼ï¸  
ğŸ‘‰ `ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ê³ , ì˜ì¡´ê´€ê³„ ì£¼ì…, ì´ˆê¸°í™”ê¹Œì§€ë§Œ ì²˜ë¦¬í•œë‹¤ëŠ” ê²ƒ`  
í´ë¼ì´ì–¸íŠ¸ì— ë¹ˆì„ ë°˜í™˜í•˜ê³ , ì´í›„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ìƒì„±ëœ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤.  
í”„ë¡œí† íƒ€ì… ë¹ˆì„ ê´€ë¦¬í•  ì±…ì„ì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ë°›ì€ í´ë¼ì´ì–¸íŠ¸ì— ìˆë‹¤.   
ğŸ‘‰ ê·¸ë˜ì„œ `@PreDestroy`ê°™ì€ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•ŠìŒ

#### ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ ë¹ˆ í…ŒìŠ¤íŠ¸
```java
package hello.core.scope;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Scope;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

public class SingletonTest {

    @Test
    public void singletonBeanFind() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(SingletonBean.class);
        SingletonBean singletonBean1 = ac.getBean(SingletonBean.class);
        SingletonBean singletonBean2 = ac.getBean(SingletonBean.class);
        System.out.println("singletonBean1 = " + singletonBean1);
        System.out.println("singletonBean2 = " + singletonBean2);
        Assertions.assertThat(singletonBean1).isSameAs(singletonBean2);

        ac.close();
    }

    @Scope("singleton")
    static class SingletonBean {

        @PostConstruct
        public void init() {
            System.out.println("SingletonBean.init");
        }

        @PreDestroy
        public void destroy() {
            System.out.println("SingletonBean.destroy");
        }
    }
}

```
ì‹¤í–‰ ê²°ê³¼
![img_99.png](img_99.png)

- ë¹ˆ ì´ˆê¸°í™” ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³ ,
- ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì˜ ë¹ˆì„ ì¡°íšŒí•˜ê³ ,
- ì¢…ë£Œ ë©”ì„œë“œê¹Œì§€ ì •ìƒ í˜¸ì¶œëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

#### í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ ë¹ˆ í…ŒìŠ¤íŠ¸
```java
package hello.core.scope;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Scope;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

public class PrototypeTest {

    @Test
    public void prototypeBeanFind() {

        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);
        System.out.println("find prototypeBean1");
        PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
        System.out.println("find prototypeBean2");
        PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);
        System.out.println("prototypeBean1 = " + prototypeBean1);
        System.out.println("prototypeBean2 = " + prototypeBean2);
        Assertions.assertThat(prototypeBean1).isNotSameAs(prototypeBean2);
        ac.close();
    }

    @Scope("prototype")
    static class PrototypeBean {

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init");
        }

        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
}

```
ì‹¤í–‰ ê²°ê³¼
![img_100.png](img_100.png)

- ì‹±ê¸€í†¤ ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹œì ì— ì´ˆê¸°í™” ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ì§€ë§Œ, í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì˜ ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ë¹ˆì„ ì¡°íšŒí•  ë•Œ ìƒì„±ë˜ê³ , ì´ˆê¸°í™” ë©”ì„œë“œë„ ì‹¤í–‰ë¨
- í”„ë¡œí† íƒ€ì… ë¹ˆì„ 2ë²ˆ ì¡°íšŒí–ˆìœ¼ë¯€ë¡œ ì™„ì „íˆ ë‹¤ë¥¸ ìŠ¤í”„ë§ ë¹ˆì´ ìƒì„±ë˜ê³ , ì´ˆê¸°í™”ë„ 2ë²ˆ ì‹¤í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ
- ì‹±ê¸€í†¤ ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ ë¹ˆì˜ ì¢…ë£Œ ë©”ì„œë“œê°€ ìƒí–‰ë˜ì§€ë§Œ, í”„ë¡œí† íƒ€ì… ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì… ê·¸ë¦¬ê³  ì´ˆê¸°í™”ê¹Œì§€ë§Œ ê´€ì—¬í•˜ê³ ,ë”ëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠìŒ
- ë”°ë¼ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ `@PreDestroy`ê°™ì€ ì¢…ë£Œ ë©”ì„œë“œê°€ ì „í˜€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ

#### í”„ë¡œí† íƒ€ì… ë¹ˆì˜ íŠ¹ì§• ì •ë¦¬
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì… ê·¸ë¦¬ê³  ì´ˆê¸°í™”ê¹Œì§€ë§Œ ê´€ì—¬
- ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ì•ŠìŒ
- ê·¸ë˜ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì€ í´ë¼ì´ì–¸íŠ¸ê°€ ê´€ë¦¬í•´ì•¼í•¨. ì¢…ë£Œ ë©”ì„œë“œì— ëŒ€í•œ í˜¸ì¶œë„ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ í•´ì•¼í•¨

### í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ ë¬¸ì œì 
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ìš”ì²­í•˜ë©´ í•­ìƒ ìƒˆë¡œìš´ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ë°˜í™˜  
í•˜ì§€ë§Œ ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©í•  ë•ŒëŠ” ì˜ë„í•œ ëŒ€ë¡œ ì˜ ë™ì‘í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì•¼í•¨

ë¨¼ì € ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì§ì ‘ ìš”ì²­í•˜ëŠ” ì˜ˆì œ

**í”„ë¡œí† íƒ€ì… ë¹ˆ ì§ì ‘ ìš”ì²­**
![img_101.png](img_101.png)
1. í´ë¼ì´ì–¸íŠ¸AëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒˆë¡œ ìƒì„±í•´ì„œ ë°˜í™˜(x01)í•œë‹¤. í•´ë‹¹ ë¹ˆì˜ count í•„ë“œ ê°’ì€ 0
3. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡°íšŒí•œ í”„ë¡œí† íƒ€ì… ë¹ˆì— `addCount()`ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ count í•„ë“œë¥¼ +1 í•œë‹¤.
4. ê²°ê³¼ì ìœ¼ë¡œ í”„ë¡œí† íƒ€ì… ë¹ˆ(x01)ì˜ countëŠ” 1ì´ ëœë‹¤.

![img_102.png](img_102.png)
1. í´ë¼ì´ì–¸íŠ¸BëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒˆë¡œ ìƒì„±í•´ì„œ ë°˜í™˜(x02). í•´ë‹¹ ë¹ˆì˜ countí•„ë“œ ê°’ì€ 0
3. í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡°íšŒí•œ í”„ë¡œí† íƒ€ì… ë¹ˆì— `addCount()`ë¥¼ í˜¸ì¶œí•˜ë©´ì„œ count í•„ë“œë¥¼ +1
4. ê²°ê³¼ì ìœ¼ë¡œ í”„ë¡œí† íƒ€ì… ë¹ˆ(x02)ì˜ countëŠ” 1

```java
package hello.core.scope;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Scope;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

public class SingletonWithPrototypeTest1 {

    @Test
    void prototypeFind() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);
        PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
        prototypeBean1.addCount();
        Assertions.assertThat(prototypeBean1.getCount()).isEqualTo(1);

        PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);
        prototypeBean2.addCount();
        Assertions.assertThat(prototypeBean2.getCount()).isEqualTo(1);
    }

    @Scope("prototype")
    static class PrototypeBean {
        private int count = 0;

        public void addCount() {
            count += 1;
        }

        public int getCount() {
            return count;
        }

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init " + this);
        }

        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }
}

```

ì‹¤í–‰ê²°ê³¼
![img_103.png](img_103.png)

#### ì‹±ê¸€í†¤ ë¹ˆì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©
ì´ë²ˆì—ëŠ” `clientBean`ì´ë¼ëŠ” ì‹±ê¸€í†¤ ë¹ˆì´ ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ í†µí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì£¼ì…ë°›ì•„ì„œ ì‚¬ìš©í•˜ëŠ” ì˜ˆ
**ì‹±ê¸€í†¤ì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©1**
![img_104.png](img_104.png)
- `clientBean`ì€ ì‹±ê¸€í†¤ì´ë¯€ë¡œ, ë³´í†µ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± ì‹œì ì— í•¨ê»˜ ìƒì„±ë˜ê³ , ì˜ì¡´ê´€ê³„ ì£¼ì…ë„ ë°œìƒ
1. `clientBean`ì€ ì˜ì¡´ê´€ê¼ ìë™ ì£¼ì…ì„ ì‚¬ìš©. ì£¼ì… ì‹œì ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìš”ì²­
2. ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•´ì„œ `clientBean`ì— ë°˜í™˜. í”„ë¡œí† íƒ€ì… ë¹ˆì˜ count í•„ë“œ ê°’ì€ 0
- ì´ì œ `clientBean`ì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ë‚´ë¶€ í•„ë“œì— ë³´ê´€ (ì •í™•íˆëŠ” ì°¸ì¡°ê°’ì„ ë³´ê´€)

**ì‹±ê¸€í†¤ì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©2**
![img_105.png](img_105.png)
- í´ë¼ì´ì–¸íŠ¸AëŠ” `clientBean`ì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•´ì„œ ë°›ìŒ. ì‹±ê¸€í†¤ì´ë¯€ë¡œ í•­ìƒ ê°™ì€ `clientBean`ì´ ë°˜í™˜
3. í´ë¼ì´ì–¸íŠ¸AëŠ” `clientBean.logic()`ì„ í˜¸ì¶œ
4. `clientBean`ì€ prototypeBeanì˜ `addCount()` í˜¸ì¶œí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì´ countë¥¼ ì¦ê°€, count ê°’ì´ 1

**ì‹±ê¸€í†¤ì—ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆ ì‚¬ìš©3**
![img_106.png](img_106.png)
- í´ë¼ì´ì–¸íŠ¸BëŠ” `clientBean`ì„ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•´ì„œ ë°›ìŒ. ì‹±ê¸€í†¤ì´ë¯€ë¡œ í•­ìƒ ê°™ì€ `clientBean`ì´ ë°˜í™˜ë¨
- ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì  âœ…
  - **`clientBean`ì´ ë‚´ë¶€ì— ê°€ì§€ê³  ìˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì€ ì´ë¯¸ ê³¼ê±°ì— ì£¼ì…ì´ ëë‚œ ë¹ˆ. ì£¼ì… ì‹œì ì— ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­í•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒˆë¡œ ìƒì„±ì´ ëœ ê²ƒì´ì§€, ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ê²ƒì€ ì•„ë‹˜**
5. í´ë¼ì´ì–¸íŠ¸BëŠ” `clientBean.logic()`ì„ í˜¸ì¶œ
6. `clientBean`ì€ prototypeBeanì˜ `addCount()`ë¥¼ í˜¸ì¶œí•´ì„œ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ countë¥¼ ì¦ê°€. ì›ë˜ count ê°’ì´ 1ì´ì—ˆìœ¼ë¯€ë¡œ 2ê°€ ë¨

```java
package hello.core.scope;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Scope;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

import static org.assertj.core.api.Assertions.assertThat;

public class SingletonWithPrototypeTest1 {

    @Test
    void prototypeFind() {
       /* AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);
        PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
        prototypeBean1.addCount();
        Assertions.assertThat(prototypeBean1.getCount()).isEqualTo(1);

        PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);
        prototypeBean2.addCount();
        Assertions.assertThat(prototypeBean2.getCount()).isEqualTo(1);*/

        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);

        ClientBean clientBean1 = ac.getBean(ClientBean.class);
        int count1 = clientBean1.logic();
        assertThat(count1).isEqualTo(1);

        ClientBean clientBean2 = ac.getBean(ClientBean.class);
        int count2 = clientBean2.logic();
        assertThat(count2).isEqualTo(2);
    }

    @Scope("prototype")
    static class PrototypeBean {
        private int count = 0;

        public void addCount() {
            count += 1;
        }

        public int getCount() {
            return count;
        }

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init " + this);
        }

        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }

    static class ClientBean {

        private final PrototypeBean prototypeBean;

        @Autowired
        public ClientBean(PrototypeBean prototypeBean) {
            this.prototypeBean = prototypeBean;
        }

        public int logic() {
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }

    }
}

```
![img_107.png](img_107.png)

ìŠ¤í”„ë§ì€ ì¼ë°˜ì ìœ¼ë¡œ ì‹±ê¸€í†¤ ë¹ˆì„ ì‚¬ìš©í•˜ë¯€ë¡œ, ì‹±ê¸€í†¤ ë¹ˆì´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤. ê·¸ëŸ°ë° ì‹±ê¸€í†¤ ë¹ˆì€ ìƒì„± ì‹œì ì—ë§Œ ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…ë°›ê¸° ë•Œë¬¸ì—, í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒˆë¡œ ìƒì„±ë˜ê¸°ëŠ” í•˜ì§€ë§Œ, ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê¼ ê³„ì† ìœ ì§€ë˜ëŠ” ê²ƒì´ ë¬¸ì œ

ì•„ë§ˆ ì›í•˜ëŠ” ê²ƒì€ ğŸ‘‰ ì£¼ì… ì‹œì ì—ë§Œ ìƒˆë¡œ ìƒì„±í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼, ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒ
> **ì°¸ê³ ** : ì—¬ëŸ¬ ë¹ˆì—ì„œ ê°™ì€ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì£¼ì… ë°›ìœ¼ë©´, **ì£¼ì… ë°›ëŠ” ì‹œì ì— ê°ê° ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒì„±**ëœë‹¤.  
> ì˜ˆë¥¼ ë“¤ì–´ì„œ clientA, clientBê°€ ê°ê° ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ ë°›ìœ¼ë©´ ê°ê° ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì˜ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì£¼ì… ë°›ìŒ  
> clientA â†’ prototypeBean@x01  
> clientB â†’ prototypeBean@x02  
> ë¬¼ë¡  ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìƒì„±ë˜ëŠ” ê²ƒì´ ì•„ë‹˜


### í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ - ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ Providerë¡œ ë¬¸ì œ í•´ê²°
ì‹±ê¸€í†¤ ë¹ˆê³¼ í”„ë¡œí† íƒ€ì… ë¹ˆì„ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ, ì–´ë–»ê²Œ í•˜ë©´ ì‚¬ìš©í• ë•Œë§ˆë‹¤ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•  ìˆ˜ ìˆì„ê¹Œ?

#### ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìš”ì²­
ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì€ í”„ë¡œí† íƒ€ì…ì„ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ìƒˆë¡œ ìš”ì²­í•˜ëŠ” ê²ƒ
```java
package hello.core.scope;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Scope;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

import static org.assertj.core.api.Assertions.assertThat;

public class PrototypeProviderTest {

    @Test
    void providerTest() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);

        ClientBean clientBean1 = ac.getBean(ClientBean.class);
        int count1 = clientBean1.logic();
        assertThat(count1).isEqualTo(1);

        ClientBean clientBean2 = ac.getBean(ClientBean.class);
        int count2 = clientBean2.logic();
        assertThat(count2).isEqualTo(1);
    }

    @Scope("prototype")
    static class PrototypeBean {
        private int count = 0;

        public void addCount() {
            count += 1;
        }

        public int getCount() {
            return count;
        }

        @PostConstruct
        public void init() {
            System.out.println("PrototypeBean.init " + this);
        }

        @PreDestroy
        public void destroy() {
            System.out.println("PrototypeBean.destroy");
        }
    }

    static class ClientBean {

        @Autowired
        private ApplicationContext ac;


        public int logic() {
            PrototypeBean prototypeBean = ac.getBean(PrototypeBean.class);
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }

    }
}

```

- `ac.getBean()`ì„ í†µí•´ì„œ í•­ìƒ ìƒˆë¡œìš´ ë¹ˆì´ ìƒì„±
- ì˜ì¡´ê´€ê³„ë¥¼ ì™¸ë¶€ì—ì„œ ì£¼ì…`(DI)`ë°›ëŠ”ê²Œ ì•„ë‹ˆë¼, ì§ì ‘ í•„ìš”í•œ ì˜ì¡´ê´€ê³„ë¥¼ ì°¾ëŠ” ê²ƒì„ `Dependencty Lookup(DL)` ì˜ì¡´ê´€ê³„ ì¡°íšŒ(íƒìƒ‰)ì´ë¼í•¨
- BUT â€¼ï¸ ì´ë ‡ê²Œ ìŠ¤í”„ë§ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ ì „ì²´ë¥¼ ì£¼ì…ë°›ê²Œ ë˜ë©´, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ì¢…ì†ì ì¸ ì½”ë“œê°€ ë˜ê³ , ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë„ ì–´ë ¤ì›€
- ì§€ì •í•œ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì»¨í…Œì´ë„ˆì—ì„œ ëŒ€ì‹  ì°¾ì•„ì£¼ëŠ” **DL** ì •ë„ì˜ ê¸°ëŠ¥ë§Œ ì œê³µí•˜ëŠ” ë¬´ì–¸ê°€ë§Œ ìˆìœ¼ë©´ ë¨

#### ObjectFactory, ObjectProvider
ì§€ì •í•œ ë¹ˆì„ ì»¨í…Œì´ë„ˆì—ì„œ ëŒ€ì‹  ì°¾ì•„ì£¼ëŠ” DL ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì´ ë°”ë¡œ `ObjectProvider`  
`ObjectFactory`ì— í¸ì˜ ê¸°ëŠ¥ì„ ì¶”ê°€í•œ ê²ƒ
```java
static class ClientBean {

        @Autowired
//        private ApplicationContext ac;
        private ObjectProvider<PrototypeBean> prototypeBeanObjectProvider;


        public int logic() {
//            PrototypeBean prototypeBean = ac.getBean(PrototypeBean.class);
            PrototypeBean prototypeBean = prototypeBeanObjectProvider.getObject();
            prototypeBean.addCount();
            int count = prototypeBean.getCount();
            return count;
        }

    }
```
![img_108.png](img_108.png)
- `prototypeBeanObjectProvider.getObject()`ë¥¼ í†µí•´ì„œ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒì„±
- `ObjectProvider`ì˜ `getObject()`ë¥¼ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì—ì„œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ í•´ë‹¹ ë¹ˆì„ ì°¾ì•„ì„œ ë°˜í™˜`(DL)`
- ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ê¸°ëŠ¥ì´ ë‹¨ìˆœí•˜ë¯€ë¡œ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê±°ë‚˜ mock ì½”ë“œë¥¼ ë§Œë“¤ê¸°ëŠ” í›¨ì”¬ ì‰¬ì›Œì§
- `ObjectProvider`ëŠ” ë”± í•„ìš”í•œ DL ì •ë„ì˜ ê¸°ëŠ¥ë§Œ ì œê³µ

##### íŠ¹ì§•
- ObjectFactory : ê¸°ëŠ¥ì´ ë‹¨ìˆœ, ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” ì—†ìŒ, ìŠ¤í”„ë§ì— ì˜ì¡´
- ObjectProvider : ObjectFactory ìƒì†, ì˜µì…˜, ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ë“± í¸ì˜ ê¸°ëŠ¥ì´ ë§ê³ , ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” ì—†ìŒ, ìŠ¤í”„ë§ì— ì˜ì¡´

#### JSR-330 Provider
`javax.inject.Provider`ë¼ëŠ” JSR-330 ìë°” í‘œì¤€ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•  
ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë ¤ë©´ `javax.inject:javax.inject:1` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ gradleì— ì¶”ê°€í•´ì•¼í•¨
```java
 static class ClientBean {
    
        @Autowired
        private Provider<PrototypeBean> provider;

        public int logic() {
            PrototypeBean prototypeBean = provider.get();
            prototypeBean.addCount();

            return prototypeBean.getCount();
        }


    }
```
![img_109.png](img_109.png)
- `provider.get()`ì„ í†µí•´ì„œ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒì„±ë¨
- `provider`ì˜ `get()`ì„ í˜¸ì¶œí•˜ë©´ ë‚´ë¶€ì—ì„œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ ì°¾ì•„ì„œ ë°˜í™˜`(DL)`
- ìë°” í‘œì¤€ì´ê³ , ê¸°ëŠ¥ì´ ë‹¨ìˆœí•˜ë¯€ë¡œ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê±°ë‚˜ Mockì½”ë“œë¥¼ ë§Œë“¤ê¸°ëŠ” í›¨ì”¬ ì‰¬ì›€
- `Provider`ëŠ” ë”± í•„ìš”í•œ DLì •ë„ì˜ ê¸°ëŠ¥ë§Œ ì œê³µ

##### íŠ¹ì§•
- `get()`ë©”ì„œë“œ í•˜ë‚˜ë¡œ ê¸°ëŠ¥ì´ ë§¤ìš° ë‹¨ìˆœ
- ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”
- ìë°” í‘œì¤€ì´ë¯€ë¡œ ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥

### ì •ë¦¬
- í”„ë¡œí† íƒ€ì… ë¹ˆì€ ì–¸ì œ ì‚¬ìš©???
  - ğŸ‘‰ ë§¤ë²ˆ ì‚¬ìš©í• ë•Œ ë§ˆë‹¤ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì™„ë£Œëœ ìƒˆë¡œìš´ ê°ì²´ê°€ í•„ìš”í•˜ë©´ ì‚¬ìš©í•˜ë©´ ë¨.
  - ê·¸ëŸ°ë° ì‹¤ë¬´ì—ì„œëŠ”, ì‹±ê¸€í†¤ ë¹ˆìœ¼ë¡œ ëŒ€ë¶€ë¶„ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì¼ì€ ë§¤ìš° ë“œë­„
- `ObjectProvider`, `JSR330 Provider`ë“±ì€ í”„ë¡œí† íƒ€ì… ë¿ë§Œ ì•„ë‹ˆë¼ DLì´ í•„ìš”í•œ ê²½ìš°ëŠ” ì–¸ì œë“ ì§€ ì‚¬ìš© ê°€ëŠ¥
  - ì§€ì—°í•´ì„œ ë˜ëŠ” optional í•´ì„œ ê°€ì ¸ì˜¬ë•Œ
  - ìˆœí•œ ì˜ì¡´(ì°¸ì¡°)ì„ ê¹¨ëœ¨ë¦´ë•Œ (a->b, b->a)
  - multiple instanceê°€ í•„ìš”í•  ë•Œ

> ì°¸ê³  : ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ë©”ì„œë“œì— `@Lookup` ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ, ì´ì „ ë°©ë²•ë“¤ë¡œ ì¶©ë¶„í•´ì„œ ìƒëµ

### ì›¹ ìŠ¤ì½”í”„
#### íŠ¹ì§•
- ì›¹ í™˜ê²½ì—ì„œë§Œ ë™ì‘
- í”„ë¡œí† íƒ€ì…ê³¼ ë‹¤ë¥´ê²Œ ìŠ¤í”„ë§ì´ í•´ë‹¹ ìŠ¤ì½”í”„ì˜ ì¢…ë£Œì‹œì ê¹Œì§€ ê´€ë¦¬í•¨. ë”°ë¼ì„œ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë¨

#### ì¢…ë¥˜
- `request` : HTTP ìš”ì²­ í•˜ë‚˜ê°€ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„, ê°ê°ì˜ HTTP ìš”ì²­ë§ˆë‹¤ ë³„ë„ì˜ ë¹ˆ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ê³  ê´€ë¦¬ë¨
- `session` : HTTP Sessionê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- `application` : ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸`(ServletContext)`ì™€ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- `websocket` : ì›¹ ì†Œì¼“ê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„

ì—¬ê¸°ì„œëŠ” request scopeë¥¼ ì˜ˆì œë¡œ ì„¤ëª….  
ë‚˜ë¨¸ì§€ë„ ë²”ìœ„ë§Œ ë‹¤ë¥´ì§€ ë™ì‘ ë°©ì‹ì€ ë¹„ìŠ·  

![img_110.png](img_110.png)

#### request ìŠ¤ì½”í”„ ì˜ˆì œ ê°œë°œ
ë™ì‹œì— ì—¬ëŸ¬ HTTP ìš”ì²­ì´ ì˜¤ë©´ ì •í™•íˆ ì–´ë–¤ ìš”ì²­ì´ ë‚¨ê¸´ ë¡œê·¸ì¸ì§€ êµ¬ë¶„í•˜ê¸° ì–´ë ¤ì›€  
ì´ëŸ´ë•Œ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ê²Œ `request ìŠ¤ì½”í”„`

ë¡œê·¸ê°€ ë‚¨ë„ë¡ request ìŠ¤ì½”í”„ë¥¼ í™œìš©í•´ì„œ ì¶”ê°€ê¸°ëŠ¥ ê°œë°œ  
- ê¸°ëŒ€í•˜ëŠ” ê³µí†µ í¬ë§· : [UUID][requestURL]{message}
- UUIDë¥¼ ì‚¬ìš©í•´ì„œ HTTP ìš”ì²­ì„ êµ¬ë¶„í•˜ì
- requestURL ì •ë³´ë„ ì¶”ê°€ë¡œ ë„£ì–´ì„œ ì–´ë–¤ URLì„ ìš”ì²­í•´ì„œ ë‚¨ì€ ë¡œê·¸ì¸ì§€ í™•ì¸

